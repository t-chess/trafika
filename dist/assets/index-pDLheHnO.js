import{P as e}from"./phaser-Cs78eZmd.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class t extends Phaser.GameObjects.Image{constructor(e){super(e,340,370,"items","bag"),this.scene=e,this.items=[],this.scene.add.existing(this),this.setOrigin(0).setInteractive({cursor:"pointer"}),this.on("pointerdown",(()=>{if(this.items.length){const e=this.items.reduce(((e,t)=>e+(t.quantity||1)),0),t=e+(1===e?" item ":" items ")+"in the bag. Empty the bag?";this.scene.speechbox.playDialogSequence([{text:t,options:[{text:"Yes",callback:()=>this.empty()},{text:"No"}]}])}else this.scene.speechbox.run("Nothing in the bag.")})),this.on("pointerover",(()=>{this.setPosition(this.x,this.y-5)})),this.on("pointerout",(()=>{this.setPosition(this.x,this.y+5)}))}addToBag(e){this.scene.sound.playAudioSprite("audios","bag");let t=this.items.find((t=>t.key===e));t?t.quantity++:this.items.push({key:e,quantity:1})}getAll(){return this.items}empty(){this.items.length=0}}const i=[{key:"news",price:19,desc:"Local news"},{key:"morleyr",price:169,desc:"Morleys. Expensive, popular, and the choice of people who think smoking should look cool.",cigs:!0},{key:"morleyb",price:169,desc:"Menthol Morleys - when you want your bad habit to smell a little less like a bad habit.",cigs:!0},{key:"jcr",price:147,desc:"JC. The kind most people smoke without thinking about it.",cigs:!0},{key:"jcb",price:147,desc:"JC but a little softer.",cigs:!0},{key:"jcm",price:147,desc:"JC but with just enough mint to cover up the cheap tobacco.",cigs:!0},{key:"ironlung",price:151,desc:"Takes a while to get used to, but I guess I have.",cigs:!0},{key:"fleuriesp",price:159,desc:"Fleuries with lavender and rose. For hippies and people who panic at the thought of being ordinary.",cigs:!0},{key:"fleuriesy",price:159,desc:"Fleuries with chamomile, mugwort and the belief that smoking herbs makes you enlightened.",cigs:!0},{key:"larissa",price:181,desc:"Larissa. I heard chewing tobacco tastes like bitter molasses and sticks to your teeth - and everything else.",shelf:!0},{key:"nicot",price:220,desc:"Nicot Rolling Tobacco. Slightly better quality, slightly moodier vibe, still just tobacco.",shelf:!0},{key:"jct",price:202,desc:"JC Pipe & Cigarette Tobacco. Not great for a pipe, not great for a cigarette, but it burns.",shelf:!0},{key:"bruyere",price:259,desc:"Bruyère pipe tobacco. For those who want to feel sophisticated.",shelf:!0},{key:"morleyt",price:250,desc:"",shelf:!0},{key:"pipes",price:777,counter:!0},{key:"papirky",price:16,desc:"Rolling papers. For rolling your own cigarettes, or whatever else.",counter:!0},{key:"cigars",price:150,counter:!0},{key:"ashtray",price:222,counter:!0},{key:"lightersl",price:399,counter:!0},{key:"lightersr",price:649,counter:!0},{key:"matches",price:11,desc:"A box of matches. Cheap, disposable, just like us.",counter:!0}];class s{constructor(e,t=450,i=270){this.scene=e,this.x=t,this.y=i,this.width=160,this.height=180,this.total=0,this.pressed={1:null,10:null,100:null},this.body=this.scene.add.image(this.x-6,this.y-37,"items","register_body").setOrigin(0).setInteractive(),this.suplik=this.scene.add.image(this.x,this.y+this.height+2,"items","register_suplik").setOrigin(0,1),this.display=this.scene.add.text(this.x+this.width-25,this.y,"0",{fontSize:"16px",color:"#ffffff"}).setOrigin(1),this.createButtons(),this.createLever(),this.order=[]}createButtons(){this.buttons=[];[["C",1,2,3,4],[5,6,7,8,9],[10,20,30,40,50],[60,70,80,90,100],[200,300,400,500,600]].forEach(((e,t)=>{e.forEach(((e,i)=>{let s=this.x+this.width-15-30*t-5,a=this.y+this.height-15-30*i-5-20,r=0,h="#ffffff",n=3750201;"C"===e?(r=16711680,h="#000000",n=11534336):e>=10&&e<=90&&(r=16777215,h="#000000",n=6842472),this.scene.add.ellipse(s,a,26,18,4479614,.4).setBlendMode("MULTIPLY");let o=this.scene.add.ellipse(s,a,26,18,r).setStrokeStyle(2,n,.7);o.setInteractive({cursor:"pointer"});let l=this.scene.add.text(s,a,`${e}`,{fontSize:e>=100?"12px":"15px",color:h}).setOrigin(.5);o.on("pointerdown",(()=>{"C"===e?this.resetInput():this.inputDigit(e)})),this.buttons.push({button:o,value:e,text:l})}))}))}inputDigit(e){"#ff0000"===this.display.style.color&&this.display.setColor("#ffffff");let t=e>=100?100:e>=10?10:1,i=this.total.toString().padStart(3,"0");const s=e.toString()[0];i=100===t?s+i.slice(1):10===t?i[0]+s+i[2]:i.slice(0,2)+s,this.total=parseInt(i,10),this.display.setText(this.total);let a=this.pressed[t];a&&(a.button.setScale(1).setY(a.button.y-5),a.text.setScale(1).setY(a.text.y-5),this.scene.sound.playAudioSprite("audios","button_up",{delay:.01}));let r=this.buttons.find((({value:t})=>t===e));r.button.setScale(.8).setY(r.button.y+5),r.text.setScale(.8).setY(r.text.y+5),this.pressed[t]=r,this.scene.sound.playAudioSprite("audios","button_down")}resetInput(){"#ff0000"===this.display.style.color&&this.display.setColor("#ffffff"),this.total=0,this.display.setText("0"),Object.values(this.pressed).forEach(((e,t)=>{e&&(e.button.setScale(1).setY(e.button.y-5),e.text.setScale(1).setY(e.text.y-5))})),this.scene.sound.playAudioSprite("audios","button_up"),this.pressed={1:null,10:null,100:null}}createLever(){this.lever=this.scene.add.image(this.x+this.width-5,this.y,"items","register_push").setOrigin(0).setInteractive({cursor:"pointer"}),this.lever.on("pointerdown",(e=>{this.isDragging=!0,this.startY=e.y})),this.scene.input.on("pointermove",(e=>{if(this.isDragging){this.hasDragged=!0;let t=e.y-this.startY;this.lever.y=Math.min(this.y+this.height/3,Math.max(this.y,this.lever.y+t)),this.startY=e.y}})),this.scene.input.on("pointerup",(()=>{this.isDragging&&!this.hasDragged&&this.scene.tweens.add({targets:this.lever,y:this.y+7,duration:150,yoyo:!0,ease:"Power1"}),this.isDragging&&(this.lever.y>this.y+30&&this.checkout(),this.lever.y=this.y,this.isDragging=!1,this.hasDragged=!1)}))}setOrder(e){this.order=e.map((e=>{let[t,i]=e.includes("X")?e.split("X"):[e,1];return{key:t,quantity:parseInt(i,10)}})),this.price=this.order.reduce(((e,t)=>e+i.find((e=>e.key===t.key)).price*t.quantity),0)}checkout(){this.order.length&&(this.compare()?this.price===this.total?(this.scene.sound.playAudioSprite("audios","purchase"),this.scene.trigger("checkout"),this.resetInput(),this.order.length=0,this.scene.bag.empty()):this.onError("wrong_price",this.total):this.onError("wrong_items"))}compare(){const e=this.scene.bag.getAll();if(this.order.length!==e.length)return!1;let t=Object.fromEntries(this.order.map((e=>[e.key,e.quantity]))),i=Object.fromEntries(e.map((e=>[e.key,e.quantity])));for(let s in t)if(i[s]!==t[s])return!1;return!0}onError(e){this.display.setColor("#ff0000"),this.scene.sound.playAudioSprite("audios","purchase_fail"),this.scene.trigger(e)}}class a extends Phaser.GameObjects.Container{constructor(e,t=15,i=3){super(e,20,460),this.scene=e,this.typingSpeed=t,this.maxOptions=i,this.withOverlay=!0,this.options=[],this.currentLines=2,this.maxCharsPerLine=60,this.init(),this.setVisible(!1),e.add.existing(this)}init(){this.overlay=this.scene.add.rectangle(0,0,640,480,0,0).setOrigin(0,0).setInteractive(),this.overlay.setVisible(!1),this.scene.add.existing(this.overlay),this.box=this.scene.add.image(0,20*-this.currentLines,"ui_atlas",`speechbox${this.currentLines}`).setOrigin(0),this.add(this.box),this.textline=this.scene.add.text(20,20*-this.currentLines+12,"",{font:"16px monospace",color:"#ffffff",wordWrap:{width:560,useAdvancedWrap:!0},lineSpacing:2}).setOrigin(0,0),this.add(this.textline),this.nextBtn=this.scene.add.text(580,-20,"▶",{font:"16px monospace",color:"#ffffff"}).setOrigin(1,.5).setVisible(!1),this.add(this.nextBtn);for(let e=0;e<this.maxOptions;e++){let e=this.scene.add.panel(600,-40,"sm").setSize(5,2).setText("");e.setVisible(!1),this.options.push(e),this.add(e)}this.setDepth(10)}setName(e){if(this.character=e,this.nameBox&&this.nameBox.destroy(),e){const e=10*Math.max(4,this.character.length);this.nameBox=this.scene.add.panel(0,20*-this.currentLines-40,"sm").setSize(Math.ceil(e/20)+2,2).setText(this.character),this.add(this.nameBox)}}updateBoxSize(e){const t=Math.ceil(e.length/this.maxCharsPerLine)+1;t!==this.currentLines&&(this.currentLines=t,this.box.setFrame(`speechbox${this.currentLines}`).setPosition(0,20*-this.currentLines),this.textline.setY(20*-this.currentLines+12),this.nameBox&&this.nameBox.setY(20*-this.currentLines-40),this.bringToTop(this.textline),this.bringToTop(this.nextBtn))}playDialogSequence(e,t=()=>{}){let i=0;const s=()=>{if(i<e.length){const{character:t,text:a,options:r,callback:h}=e[i];i++,t!==this.character&&this.setName(t),h&&h(),this.run(a,r,(e=>{this.handleOption(e,s)}))}else t()};s()}handleOption(e,t){if(e&&e.after)switch(e.after){case"continue":default:t();break;case"break":this.scene.scene.start(e.next);break;case"response-continue":this.playDialogSequence(e.response,t);break;case"response-break":this.playDialogSequence(e.response,(()=>{this.scene.scene.start(e.next)}))}else t()}run(e,t=[],i){this.hideOptions(),this.setVisible(!0),this.withOverlay&&this.overlay.setVisible(!0),this.box.disableInteractive(),this.textline.setText(""),this.nextBtn.setVisible(!1),this.updateBoxSize(e);let s=0,a="";this.typewriterTimer&&this.typewriterTimer.remove(!1),this.typewriterTimer=this.scene.time.addEvent({delay:this.typingSpeed,loop:!0,callback:()=>{s<e.length?(a+=e[s],s++,this.textline.setText(a)):(this.typewriterTimer.remove(!1),t.length>0?this.showOptions(t,i):(this.nextBtn.setVisible(!0),this.box.removeAllListeners("pointerdown"),this.box.setInteractive({cursor:"pointer"}).once("pointerdown",(()=>{this.scene.sound.play("ui_click"),this.overlay.setVisible(!1),this.setVisible(!1),i&&i()}))))}})}showOptions(e,t){let i=20*this.currentLines;[...e].reverse().forEach((({text:e,callback:s,...a},r)=>{const h=Math.max(3,Math.ceil(e.length/2)+2);this.options[r].setSize(h,2).setText(e).setPosition(600-20*h,-40-i).setVisible(!0).onClick((()=>{this.scene.sound.play("ui_click"),this.hideOptions(),this.overlay.setVisible(!1),this.setVisible(!1),s&&s(),t&&t({text:e,...a})}),!0),i+=40}))}hideOptions(){this.options.forEach((e=>{e.setVisible(!1),e.onClick(null)}))}disableOverlay(){return this.withOverlay=!1,this}}const r={products:[{filename:"register_body",frame:{x:0,y:0,w:176,h:225}},{filename:"register_suplik",frame:{x:0,y:225,w:170,h:29}},{filename:"register_push",frame:{x:611,y:92,w:20,h:66}},{filename:"shelf",frame:{x:0,y:254,w:583,h:75}},{filename:"counter",frame:{x:0,y:329,w:640,h:50}},{filename:"news",frame:{x:176,y:0,w:359,h:81}},{filename:"bag",frame:{x:535,y:0,w:105,h:92}},{filename:"lightersl",frame:{x:176,y:81,w:57,h:111}},{filename:"lightersr",frame:{x:233,y:81,w:40,h:111}},{filename:"larissa",frame:{x:273,y:81,w:50,h:62}},{filename:"matches",frame:{x:273,y:143,w:48,h:49}},{filename:"nicot",frame:{x:323,y:81,w:64,h:87}},{filename:"jct",frame:{x:387,y:81,w:53,h:74}},{filename:"morleyt",frame:{x:440,y:81,w:45,h:35}},{filename:"bruyere",frame:{x:440,y:116,w:49,h:40}},{filename:"pipes",frame:{x:489,y:92,w:122,h:104}},{filename:"cigars",frame:{x:583,y:254,w:57,h:75}},{filename:"papirky",frame:{x:488,y:196,w:65,h:50}},{filename:"ashtray",frame:{x:553,y:196,w:74,h:52}},{filename:"papers",frame:{x:401,y:156,w:88,h:40}},{filename:"cig1",frame:{x:640,y:0,w:59,h:79}},{filename:"cig2",frame:{x:631,y:92,w:79,h:65}},{filename:"cig3",frame:{x:628,y:158,w:77,h:51}},{filename:"cig4",frame:{x:640,y:209,w:58,h:104}},{filename:"cig5",frame:{x:698,y:209,w:49,h:104}},{filename:"ash",frame:{x:640,y:313,w:50,h:50}},{filename:"match1",frame:{x:710,y:0,w:53,h:161}},{filename:"match2",frame:{x:747,y:200,w:27,h:179}}],characters:[{filename:"felix",frame:{x:0,y:0,w:272,h:441}},{filename:"pierrick",frame:{x:0,y:441,w:254,h:407}},{filename:"raphael",frame:{x:0,y:848,w:238,h:384}},{filename:"mado",frame:{x:254,y:441,w:205,h:367}}]},h=[{key:"starttut1",characters:[{key:"felix"}],order:["bruyere","matchesX3"],dialogues:{entry:[{character:"Félix",text:"Oke bitch listen here. I want pipe tobacco and 3 boxes of matches."},{character:"Félix",text:"Drag them into the bag, calculate the price and enter it into the register."},{character:"Félix",text:"Don't be stupid.",emotion:"angry"}],wrong_items:[{character:"Félix",text:"Wrong items text.",flag:"tut1_mistake",onComplete:"clicks"}],wrong_price:[{character:"Félix",text:"Wrong price text.",flag:"tut1_mistake"}],click:[{character:"Félix",text:"Pipe tobacco and 3 boxes of matches.",options:[{text:"Yeah boss",flag:"being_polite"},{text:"..."}]}],checkout:[{character:"Félix",text:"You did it, now let's try one more time."}]}},{key:"starttut2",characters:[{key:"felix"}],order:["news","cigars"],dialogues:{entry:[{character:"Félix",text:"You got it right last time, let's see if it wasn't a fluke."}],entry_being_polite:[{character:"Félix",text:"Awwww "}],entry_tut1_mistake:[{character:"Félix",text:"Let's see if you learned anything."}],wrong_price:[{character:"Félix",text:"Not again, dumbass!",emotion:"angry"}],checkout:[{character:"Félix",text:"Well done. Well, have fun, you can read newspapers or magazines if you want. See ya."}]}}];class n{constructor(e){this.scene=e,this.characters={},this.charsLayer=this.scene.add.container(0,0),this.smooth=!0,this.clickText=null,this.askBtn=this.scene.add.panel(300,200,"sm",18).setSize(2,2).setText("?").setVisible(!1).onClick((()=>{this.startDialogue(this.clickText,"click")}))}resetCharacters(e=[]){return this.clickText=null,this.charsLayer.list.length?this.scene.tweens.add({targets:this.charsLayer.list,alpha:0,duration:this.smooth?500:0,ease:"Power2",onComplete:()=>{this.charsLayer.removeAll(!0),this.characters={},this.addCharacters(e)}}):this.addCharacters(e),this}addCharacters(e){return e.forEach((e=>{let t=this.scene.add.image(o[e.key].x,o[e.key].y,"characters",e.key).setOrigin(0).setAlpha(0);this.charsLayer.add(t),this.characters[e.key]=t,this.scene.tweens.add({targets:t,alpha:1,duration:500,ease:"Power2"})})),this}startDialogue(e,t){const i=e.map((e=>e.options?{...e,options:e.options.map((e=>({...e,callback:()=>{e.flag&&(this.scene.gameState.flags[e.flag]=!0),e.event&&this.scene.trigger(e.event)}})))}:e));return this.scene.speechbox.playDialogSequence(i,(()=>{var i;(null==t?void 0:t.includes("entry"))&&(null==(i=this.scene.loopdata.dialogues.click)?void 0:i.length)&&!this.clickText&&(this.setClickText(this.scene.loopdata.dialogues.click),this.showAskButton());const s=e.find((e=>e.onComplete));s?this.scene.trigger(s):"checkout"===t&&this.scene.trigger("loop_end")})),this}setClickText(e){this.clickText=e}showAskButton(e=!0){this.askBtn.setVisible(e)}}const o={felix:{x:135,y:40},pierrick:{x:110,y:73},raphael:{x:130,y:80},mado:{x:150,y:113}};class l extends Phaser.GameObjects.Sprite{constructor(e,t=600,i=40,s=!0){super(e,t,i,"ui_atlas",s?"sound-on":"sound-off"),this.scene=e,this.setInteractive({cursor:"pointer"}),void 0===l.isSoundOn&&(l.isSoundOn=s),this.updateTexture(),this.on("pointerdown",this.toggleSound,this),this.scene.add.existing(this)}toggleSound(){l.isSoundOn=!l.isSoundOn,this.updateTexture(),this.scene.sound.setMute(!l.isSoundOn)}updateTexture(){this.setTexture("ui_atlas",l.isSoundOn?"sound-on":"sound-off")}}class c extends Phaser.Scene{constructor(e=[]){super("Main"),this.gameState={loop:-1,loopdata:null,flags:{}}}preload(){this.load.setPath("assets"),this.load.atlas("items","items.png",{frames:[...r.products,...i.filter((e=>!0===e.cigs)).map(((e,t)=>({filename:e.key,frame:{x:176+39*t,y:196,w:39,h:58}})))]}),this.load.atlas("characters","characters.png",{frames:r.characters}),this.load.audioSprite("audios",{resources:["audios.mp3"],spritemap:{button_down:{start:0,end:.482},button_up:{start:.482,end:.903},purchase:{start:.903,end:3.78},purchase_fail:{start:3.78,end:3.879},bag:{start:3.879,end:4.725}}})}create(){this.frame=new n(this),this.initNewspapers(),this.add.image(0,431,"items","counter").setOrigin(0),this.initShelf(),this.cashRegister=new s(this),this.initCounterItems(),this.bag=new t(this),this.speechbox=new a(this),new l(this),setTimeout((()=>this.startNextLoop()),500)}startNextLoop(){this.gameState.loop++,this.loopdata=h[this.gameState.loop],this.cashRegister.setOrder(this.loopdata.order),this.frame.resetCharacters(this.loopdata.characters);let e="entry";console.log(this.gameState.flags),Object.keys(this.gameState.flags).forEach((t=>{this.gameState.flags[t]&&this.loopdata.dialogues[`entry_${t}`]&&(e=`entry_${t}`)})),this.trigger(e)}trigger(e){console.log(e),this.loopdata.dialogues[e]&&this.frame.startDialogue(this.loopdata.dialogues[e],e),"checkout"===e&&this.frame.showAskButton(!1),"loop_end"===e&&this.startNextLoop()}initNewspapers(){this.initProduct(this.add.image(81,50,"items","news").setAngle(90).setFlipY(!0).setOrigin(0));let e=i.find((e=>"news"===e.key)).price;this.add.text(10,190,e,{fontSize:"12px",backgroundColor:"#fff",color:"#000"})}initShelf(){this.shelfCont=this.add.container(0,0),this.shelfShow=!0;let e=this.add.image(30,0,"items","shelf").setOrigin(0).setInteractive({cursor:"pointer"});e.on("pointerdown",(()=>{this.tweens.add({targets:this.shelfCont,y:this.shelfShow?-50:0,duration:300,ease:"Power2"}),this.shelfShow=!this.shelfShow})),this.shelfCont.add(e);const t={fontSize:"11px",backgroundColor:"#ffffff",color:"#000000"};i.filter((e=>!0===e.cigs)).map(((e,i)=>(e.obj=this.add.image(60+39*i,0,"items",e.key).setOrigin(0),this.shelfCont.add(e.obj),this.shelfCont.add(this.add.text(67+39*i,54,e.price,t)),this.initProduct(e.obj,3),e)));const s=Object.fromEntries(i.filter((e=>!0===e.shelf)).map((e=>[e.key,e.price])));this.shelfCont.add(this.initProduct(this.add.image(430,-2,"items","larissa").setOrigin(0),5)),this.shelfCont.add(this.add.text(444,54,s.larissa,t)),this.shelfCont.add(this.initProduct(this.add.image(525,-20,"items","nicot").setOrigin(0),12)),this.shelfCont.add(this.add.text(540,54,s.nicot,t)),this.shelfCont.add(this.initProduct(this.add.image(484,-13,"items","jct").setOrigin(0),5)),this.shelfCont.add(this.add.text(503,54,s.jct,t)),this.shelfCont.add(this.initProduct(this.add.image(387,20,"items","bruyere").setOrigin(0),5)),this.shelfCont.add(this.add.text(400,63,s.bruyere,t)),this.shelfCont.add(this.initProduct(this.add.image(390,-7,"items","morleyt").setOrigin(0))),this.shelfCont.add(this.add.text(400,52,s.morleyt,t))}initCounterItems(){const e=Object.fromEntries(i.filter((e=>!0===e.counter)).map((e=>[e.key,e.price])));[{key:"pipes",x:0,y:353,priceX:50,priceY:450},{key:"papirky",x:0,y:315,priceX:15,priceY:330},{key:"cigars",x:55,y:288,priceX:75,priceY:350},{key:"ashtray",x:111,y:408,priceX:140,priceY:454},{key:"lightersl",x:505,y:135,priceX:525,priceY:225},{key:"lightersr",x:562,y:135,priceX:570,priceY:225},{key:"matches",x:458,y:195,priceX:475,priceY:230}].forEach((({key:t,x:i,y:s,priceX:a,priceY:r})=>{this.initProduct(this.add.image(i,s,"items",t).setOrigin(0)),this.add.text(a,r,e[t],{fontSize:"12px",backgroundColor:"#fff",color:"#000"})}))}initProduct(e,t){let s,a;e.setInteractive({draggable:!0}),t&&e.setCrop(0,0,e.width,e.height-t-5),e.on("pointerover",(()=>{e.setPosition(e.x,e.y-5),t&&e.setCrop(0,0,e.width,e.height-t)})),e.on("pointerout",(()=>{e.setPosition(e.x,e.y+5),t&&e.setCrop(0,0,e.width,e.height-t-5)})),e.on("pointerdown",(()=>{s=!1})),e.on("pointerup",(()=>{var t;const a=null==(t=i.find((t=>t.key===e.frame.name)))?void 0:t.desc;!s&&a&&a&&this.speechbox.run(a,"news"===e.frame.name&&[{text:"Read latest news"},{text:"Nevermind"}])}));const r={pipes:[[88,17,122,104],[.75,.5]],papirky:[[30,30,65,50],[.75,1]],matches:[[0,0,25,30],[.5]],lightersl:[[7,10,30,40],[.5,.25]],lightersr:[[15,50,40,30],[.75]]}[e.frame.name];return e.on("dragstart",(()=>{a=e.scene.add.image(e.x,e.y,"items","news"===e.frame.name?"papers":e.frame.name).setOrigin(.5).setAlpha(.3).setVisible(!1),r&&a.setCrop(...r[0]).setOrigin(...r[1])})),e.on("drag",(e=>{s=!0,a&&(a.visible||a.setVisible(!0),a.setPosition(e.x,e.y))})),e.on("dragend",(t=>{e.setAlpha(1);let i=this.bag.getBounds(),r=a.getBounds();Phaser.Geom.Intersects.RectangleToRectangle(r,i)&&this.bag.addToBag(e.frame.name),a.destroy(),a=null,setTimeout((()=>{s=!1}),50)})),e}}class d extends Phaser.GameObjects.Container{constructor(e,t,i,s="md",a=16){super(e,t,i),this.scene=e,this.type=s,this.tileSize="sm"===s?20:40,this.fontSize=a,this.inverted=!1,this.static=!1,this.clickable=!1,e.add.existing(this)}setSize(e,t){if(this.width===e&&this.height===t)return this;this.width=e,this.height=t,this.list.filter((e=>e!==this.textObject)).forEach((e=>e.destroy()));const i=(e,t,i)=>this.add(this.scene.add.image(e,t,"ui_atlas",i).setOrigin(0));let s=this.scene.add.rectangle(this.tileSize,this.tileSize,(this.width-2)*this.tileSize,(this.height-2)*this.tileSize,0).setOrigin(0);this.background=s,this.add(s),i(0,0,`${this.type}-lt`);for(let a=1;a<this.width-1;a++)i(a*this.tileSize,0,`${this.type}-t`);i((this.width-1)*this.tileSize,0,`${this.type}-rt`);for(let a=1;a<this.height-1;a++)i(0,a*this.tileSize,`${this.type}-l`),i((this.width-1)*this.tileSize,a*this.tileSize,`${this.type}-r`);i(0,(this.height-1)*this.tileSize,`${this.type}-lb`);for(let a=1;a<this.width-1;a++)i(a*this.tileSize,(this.height-1)*this.tileSize,`${this.type}-b`);return i((this.width-1)*this.tileSize,(this.height-1)*this.tileSize,`${this.type}-rb`),this.textObject&&(this.textObject.setWordWrapWidth((this.width-1)*this.tileSize),this.textObject.setPosition(this.width*this.tileSize/2,this.height*this.tileSize/2),this.bringToTop(this.textObject)),this.clickable&&this.updateClickArea(),this}setText(e){return this.textObject?this.textObject.setText(e):(this.textObject=this.scene.add.text(this.width*this.tileSize/2,this.height*this.tileSize/2,e,{fontSize:`${this.fontSize}px`,color:"#ffffff",align:"center",lineSpacing:2,wordWrap:{width:(this.width-1)*this.tileSize,useAdvancedWrap:!0}}).setOrigin(.5),this.add(this.textObject)),this}onClick(e,t){if(!e)return this.clickable=!1,void this.disableInteractive();this.off("pointerdown"),this.clickable=!0,this.updateClickArea(),this.on("pointerover",(()=>{this.scene.input.setDefaultCursor("pointer"),this.static||this.setPosition(this.x,this.y-1)})),this.on("pointerout",(()=>{this.scene.input.setDefaultCursor("default"),this.static||this.setPosition(this.x,this.y+1)}));const i=()=>{this.scene.sound.play("ui_click"),this.scene.input.setDefaultCursor("default"),e()};return t?this.once("pointerdown",i):this.on("pointerdown",i),this}invertColors(e="toggle"){if(!("on"===e&&this.inverted||"off"===e&&!this.inverted))return this.colorMatrixEffects||(this.colorMatrixEffects=this.list.filter((e=>e.preFX)).map((e=>({child:e,effect:e.preFX.addColorMatrix()})))),this.colorMatrixEffects.forEach((({effect:e})=>{this.inverted?e.saturate():e.negative()})),this.background.setFillStyle(0===this.background.fillColor?16777215:0),this.inverted=!this.inverted,this}setStatic(e){return this.static=e,this}updateClickArea(){const e=new Phaser.Geom.Rectangle(0,0,this.width*this.tileSize,this.height*this.tileSize),t=Phaser.Geom.Rectangle.Contains;this.input&&(this.input.hitArea=e,this.input.hitAreaCallback=t),this.setInteractive(e,t)}}class p extends Phaser.GameObjects.Container{constructor(e,t,i,s,a,r="right",h=16){super(e,t,i),this.scene=e,this.width=s,this.text=a,this.direction=r,this.fontSize=h,this.inverted=!1,this.init(),a&&this.addText(),e.add.existing(this)}init(){const e=(e,t,i)=>this.add(this.scene.add.image(e,t,"ui_atlas",i).setOrigin(0));for(let t=1;t<this.width-2;t++){const i="right"===this.direction?t:t+1;e(20*i,0,"sm-t"),e(20*i,20,"sm-b")}"right"===this.direction?(e(0,0,"sm-lt"),e(0,20,"sm-lb"),this.add(this.scene.add.image(20*(this.width-2),0,"ui_atlas","arrow").setOrigin(0))):(e(20*(this.width-1),0,"sm-rt"),e(20*(this.width-1),20,"sm-rb"),this.add(this.scene.add.image(0,0,"ui_atlas","arrow").setFlipX(!0).setOrigin(0)))}addText(){this.add(this.scene.add.text(20*this.width/2,20,this.text,{fontSize:`${this.fontSize}px`,color:"#ffffff",align:"center"}).setOrigin(.5))}onClick(e){if(e)return this.setInteractive(new Phaser.Geom.Rectangle(0,0,20*this.width,40),Phaser.Geom.Rectangle.Contains),this.on("pointerover",(()=>{this.scene.input.setDefaultCursor("pointer"),this.setPosition(this.x,this.y-2)})),this.on("pointerout",(()=>{this.scene.input.setDefaultCursor("default"),this.setPosition(this.x,this.y+2)})),this.on("pointerdown",(()=>{this.scene.sound.play("ui_click"),this.scene.input.setDefaultCursor("default"),e()})),this;this.disableInteractive()}invertColors(e="toggle"){"on"===e&&this.inverted||"off"===e&&!this.inverted||(this.list.forEach((e=>{e.preFX&&e.preFX.addColorMatrix().negative()})),this.inverted=!this.inverted)}}class g extends Phaser.Scene{constructor(e,t="Loading"){super({key:"Boot"}),this.loadingBg=e,this.afterBootScene=t}init(){Phaser.GameObjects.GameObjectFactory.register("panel",(function(...e){const t=new d(this.scene,...e);return this.displayList.add(t),t})),Phaser.GameObjects.GameObjectFactory.register("arrowpanel",(function(...e){const t=new p(this.scene,...e);return this.displayList.add(t),t}))}preload(){this.load.atlas("ui_atlas","assets/interface/ui.png",{frames:[{filename:"speechbox2",frame:{x:0,y:0,w:600,h:40}},{filename:"md-lb",frame:{x:0,y:40,w:40,h:40}},{filename:"md-b",frame:{x:40,y:40,w:40,h:40}},{filename:"md-rb",frame:{x:80,y:40,w:40,h:40}},{filename:"md-l",frame:{x:120,y:40,w:40,h:40}},{filename:"md-r",frame:{x:160,y:40,w:40,h:40}},{filename:"md-lt",frame:{x:200,y:40,w:40,h:40}},{filename:"md-t",frame:{x:240,y:40,w:40,h:40}},{filename:"md-rt",frame:{x:280,y:40,w:40,h:40}},{filename:"arrow-solo",frame:{x:320,y:40,w:40,h:40}},{filename:"arrow",frame:{x:360,y:40,w:40,h:40}},{filename:"sound-on",frame:{x:400,y:40,w:40,h:40}},{filename:"sound-off",frame:{x:440,y:40,w:40,h:40}},{filename:"circle",frame:{x:480,y:40,w:40,h:40}},{filename:"sm-lt",frame:{x:520,y:40,w:20,h:20}},{filename:"sm-rt",frame:{x:540,y:40,w:20,h:20}},{filename:"sm-l",frame:{x:560,y:40,w:20,h:20}},{filename:"sm-t",frame:{x:580,y:40,w:20,h:20}},{filename:"sm-lb",frame:{x:520,y:60,w:20,h:20}},{filename:"sm-rb",frame:{x:540,y:60,w:20,h:20}},{filename:"sm-b",frame:{x:560,y:60,w:20,h:20}},{filename:"sm-r",frame:{x:580,y:60,w:20,h:20}},{filename:"speechbox3",frame:{x:0,y:80,w:600,h:60}},{filename:"speechbox4",frame:{x:0,y:140,w:600,h:80}}]}),this.load.audio("ui_click","assets/interface/lighter.mp3"),this.loadingBg&&this.load.image("loadingBg",this.loadingBg)}create(){this.time.delayedCall(100,(()=>{this.scene.start(this.afterBootScene)}))}}class u extends Phaser.Scene{constructor(e="CutScene",t=!0){super({key:e}),this.scenesArray=[],this.smooth=t}setScenes(e){this.sound.pauseOnBlur=!1,this.scenesArray=e,this.nextIndex=0,this.scenesArray.forEach((e=>{this[e.bgKey]=this.add.sprite(640,480,e.bgKey).setVisible(!1).setPosition(320,240)})),this.nextArrow=this.add.image(620,460,"ui_atlas","arrow-solo").setOrigin(1).setVisible(!1).setInteractive({cursor:"pointer"}),this.speechbox=new a(this),new l(this),this.continue()}onEnd(e){this.endCallback=e}continue(){if(this.nextIndex===this.scenesArray.length&&this.endCallback)return void this.endCallback();this.nextArrow.setVisible(!1);const e=this.scenesArray[this.nextIndex],t=this[e.bgKey];this.smooth?(t.setAlpha(0),t.setVisible(!0),t.setDepth(1),this.currentBg&&this.currentBg!==t&&this.currentBg.setDepth(0),this.tweens.add({targets:t,alpha:1,duration:500,ease:"Power2",onComplete:()=>{this.currentBg&&this.currentBg!==t&&this.currentBg.setVisible(!1),this.currentBg=t}})):this.scenesArray.forEach(((e,t)=>{this[e.bgKey].setVisible(t===this.nextIndex)})),this.time.delayedCall(e.delay||1e3,(()=>{e.dialog&&e.dialog.length?this.speechbox.playDialogSequence(e.dialog,(()=>{this.time.delayedCall(500,(()=>{this.continue()}))})):(this.nextArrow.setVisible(!0),this.nextArrow.once("pointerdown",(()=>{this.sound.play("ui_click"),this.continue()})))})),this[e.bgKey].setVisible(!0),this.nextIndex++}}class m extends Phaser.Scene{constructor(){super("Ashtray")}preload(){this.load.setPath("assets"),this.load.atlas("items","items.png",{frames:[...r.products]}),this.load.image("ashtray","cuts/ashtray.png")}create(){this.add.image(0,0,"ashtray").setOrigin(0),this.rt=this.add.renderTexture(0,0,640,480).setOrigin(0),this.heartPolygon=new Phaser.Geom.Polygon([{x:250,y:140},{x:200,y:120},{x:120,y:120},{x:50,y:170},{x:40,y:220},{x:60,y:270},{x:120,y:330},{x:190,y:370},{x:390,y:420},{x:430,y:350},{x:460,y:270},{x:480,y:150},{x:470,y:100},{x:430,y:50},{x:370,y:20},{x:300,y:50},{x:250,y:140}]),this.copy=null,this.isDragging=!1,this.things=this.add.group(),[{frame:"cig1",x:535,y:80},{frame:"cig4",x:590,y:130},{frame:"cig5",x:530,y:180},{frame:"cig3",x:590,y:220},{frame:"cig2",x:530,y:280},{frame:"match1",x:520,y:370,rotation:.7},{frame:"match2",x:610,y:340}].forEach((e=>{let t=this.add.image(e.x,e.y,"items",e.frame).setInteractive({cursor:"pointer",draggable:!0}).setOrigin(.5).setRotation(e.rotation);t.on("dragstart",(()=>{this.copy=this.add.image(e.x,e.y,"items",e.frame).setOrigin(.5).setAngle(t.angle).setVisible(!1)})),t.on("drag",(t=>{window.innerWidth<1e3&&Phaser.Math.Distance.Between(e.x,e.y,t.x,t.y)<15||(this.isDragging=!0,this.copy&&(this.copy.visible||this.copy.setVisible(!0),this.copy.setPosition(t.x,t.y)))})),t.on("dragend",(e=>{this.contains(e.x,e.y)&&this.rt.draw(this.copy,e.x,e.y),this.copy.destroy(),this.copy=null,setTimeout((()=>{this.isDragging=!1}),50)})),t.on("pointerdown",(()=>{this.isDragging=!1})),t.on("pointerup",(()=>{this.isDragging||t.setAngle(t.angle+45)})),this.things.add(t)})),this.add.panel(20,420,"sm",20).setSize(2,2).setText("?").onClick((()=>{this.speechbox.run("Кликнуть на окурки/спички чтобы их повернуть, перетащить чтобы положить в попелник. Просто потыкать туда чтобы порисовать пеплом.")})),this.input.on("pointermove",(e=>{e.isDown&&!this.isDragging&&this.contains(e.x,e.y)&&(!this.lastX||Phaser.Math.Distance.Between(this.lastX,this.lastY,e.x,e.y)>15)&&(this.lastX=e.x,this.lastY=e.y,this.rt.drawFrame("items","ash",e.x-Phaser.Math.Between(20,30),e.y-Phaser.Math.Between(20,30)))}),this),this.speechbox=new a(this)}contains(e,t){return Phaser.Geom.Polygon.Contains(this.heartPolygon,e,t)}}new e.Game({type:e.AUTO,width:640,height:480,parent:"container",backgroundColor:6908265,powerPreference:"high-performance",scene:[new g(void 0,"Ashtray"),class extends u{constructor(){super("Intro")}preload(){this.load.image("padik1","assets/cuts/padik1.png"),this.load.image("padik2","assets/cuts/padik2.png"),this.load.image("padik3","assets/cuts/padik3.png")}create(){this.setScenes([{bgKey:"padik1",dialog:[{text:"When I was little, the fishmonger was downstairs."},{text:"The whole building smelled like salt and guts, but after a while, I stopped noticing. Mom never did."}]},{bgKey:"padik2",dialog:[{text:"Then it became a photo studio."},{text:"No more fish, just chemicals, paper and whatever cologne that prickish photographer marinated in daily."}]},{bgKey:"padik3",dialog:[{text:"Then I was gone for a while. Now it's a tobacco shop."},{text:"Out of everything, this smell makes the most sense. Ashes to ashes, you know?"},{text:"Also it looks like Felix, the owner, isn't gonna let me just sit here.",options:[{text:"Хули вылупился?"},{text:"Grrr >:C"}]}]}])}},c,m]});
